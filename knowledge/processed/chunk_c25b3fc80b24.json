{
  "id": "c25b3fc80b24",
  "source": "Quantitative_Trading.pdf",
  "source_type": "pdf",
  "title": "Quantitative Trading",
  "chunk_index": 35,
  "content": "first into cell arrays and % then into numeric format. tday1=str2double(cellstr(tday1)); % the last column contains the adjusted close prices. adjcls1=num(:, end); % read a spreadsheet named \"GDX.xls\" into MATLAB. [num2, txt2]=xlsread('GDX'); % the first column (starting from the second row) is % the trading days in format mm/dd/yyyy. tday2=txt2(2:end, 1); % convert the format into yyyymmdd. tday2=.. datestr(datenum(tday2, 'mm/dd/yyyy'), 'yyyymmdd'); % convert the date strings first into cell arrays and % then into numeric format. tday2=str2double(cellstr(tday2)); adjcls2=num2(:, end); % find all the days when either GLD or GDX has data. tday=union(tday1, tday2); [foo idx idx1]=intersect(tday, tday1); % combining the two price series adjcls=NaN(length(tday), 2); adjcls(idx, 1)=adjcls1(idx1); Chan800064_c07.indd 149 6/7/2021 7:16:57 AM 73 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 150 QUANTITATIVE TRADING [foo idx idx2]=intersect(tday, tday2); adjcls(idx, 2)=adjcls2(idx2); % days where any one price is missing baddata=find(any(~isfinite(adjcls), 2)); tday(baddata)=[]; adjcls(baddata,:)=[]; trainset=1:252; % define indices for training set vnames=strvcat('GLD', 'GDX'); adjcls=adjcls(trainset, :); tday=tday(trainset, :); % run cointegration check using % augmented Dickey-Fuller test res=cadf(adjcls(:, 1), adjcls(:, 2), 0, 1); prt(res, vnames); % Output from cadf function: % Augmented DF test for co-integration variables: GLD,GDX % CADF t-statistic # of lags AR(1) estimate % -3.18156477 1 -0.070038 % % 1% Crit Value 5% Crit Value 10% Crit Value % -3.924 -3.380 -3.082 % The t-statistic of -3.18 which is in between the 5% Crit Value of -3.38 % and the 10% Crit Value of -3.08 means that there is a better than 90% % probability that these 2 time series are cointegrated. results=ols(adjcls(:, 1), adjcls(:, 2)); hedgeRatio=results.beta z=results.resid; % A hedgeRatio of 1.6766 was found. % I.e. GLD=1.6766*GDX + z, where z can be % interpreted as the % spread GLD-1.6766*GDX and should be stationary. % This should produce a chart similar to Figure 7.2. plot(z); Using Python The following program is available as epchan.com/book/example7_2.ipynb: How to Form a Good Cointegrating (and Mean-Reverting) Pair of Stocks import numpy as np import pandas as pd import matplotlib.pyplot as plt Chan800064_c07.indd 150 6/7/2021 7:16:57 AM 74 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Special Topics in Quantitative Trading 151 from statsmodels.tsa.stattools import coint from statsmodels.api import OLS df1=pd.read_excel('GLD.xls') df2=pd.read_excel('GDX.xls') df=pd.merge(df1, df2, on='Date', suffixes=('_GLD', '_GDX')) df.set_index('Date', inplace=True) df.sort_index(inplace=True) trainset=np.arange(0, 252) df=df.iloc[trainset,] Run cointegration (Engle-Granger) test coint_t, pvalue, crit_value=coint(df['Adj Close_GLD'], df['Adj Close_GDX']) (coint_t, pvalue, crit_value) # abs(t-stat) > critical value at 95%. pvalue says probability of null hypo- thesis (of no cointegration) is only 1.8% (-2.3591268376687244, 0.3444494880427884, array([-3.94060523, -3.36058133, -3.06139039])) Determine hedge ratio model=OLS(df['Adj Close_GLD'], df['Adj Close_GDX']) results=model.fit() hedgeRatio=results.params hedgeRatio Adj Close_GDX 1.631009 dtype: float64 spread = GLD - hedgeRatio*GDX spread=df['Adj Close_GLD']-hedgeRatio[0]*df['Adj Close_GDX'] plt.plot(spread) You may notice that the Python code\u2019s Engle-Granger test generates a t-statistic of \u20132.4, whose absolute value is less than the 90% critical value, indicating that the two series are not cointegrating. This contradicts the results of the MATLAB cadf test. Which should we trust? Let me just say that Python\u2019s libraries are free and come with no guarantees on accuracy nor correctness, whereas MATLAB employs a staff of numerous PhD com- puter scientists and statisticians. Using R You can download the R code as example7_2.R. # Need the zoo package for its na.locf function install.packages('zoo') # Need the CADFtest package for its CADFtest function install.packages('CADFtest') library('zoo') library('CADFtest') Chan800064_c07.indd 151 6/7/2021 7:16:57 AM 75 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 152 QUANTITATIVE TRADING data1 <- read.delim(\"GLD.txt\") # Tab-delimited data_sort1 <- data1[order(as.Date(data1[,1], '%m/%d/%Y')),] # sort in ascending order of dates (1st column of data) tday1 <- as.integer(format(as.Date(data_sort1[,1], '%m/%d/%Y'), '%Y%m%d')) adjcls1 <- data_sort1[,ncol(data_sort1)] data2 <- read.delim(\"GDX.txt\") # Tab-delimited data_sort2 <- data2[order(as.Date(data2[,1], '%m/%d/%Y')),] # sort in ascending order of dates (1st column of data) tday2 <- as.integer(format(as.Date(data_sort2[,1], '%m/%d/%Y'), '%Y%m%d')) adjcls2 <- data_sort2[,ncol(data_sort2)] # find the intersection of the two data sets tday <- intersect(tday1, tday2) adjcls1 <- adjcls1[tday1 %in% tday] adjcls2 <- adjcls2[tday2 %in% tday] # CADFtest cannot have NaN values in input adjcls1 <- zoo::na.locf(adjcls1) adjcls2 <- zoo::na.locf(adjcls2) mydata <- list(GLD=adjcls1, GDX=adjcls2); trainset <- 1:252 res <- CADFtest(model=GLD~GDX, data=mydata, type = \"drift\", max.lag.X=1, subset=trainset) summary(res) # As the following input shows, p-value is about 0.005; hence we can reject null hypothesis of no cointegration at 99.5% level. # Covariate Augmented DF test # CADF test # t-test statistic: -3.240868894 # estimated rho^2: 0.260414676 # p-value: 0.004975155 # Max lag of the diff. dependent variable: 1.000000000 # Max lag of the stationary covariate(s): 1.000000000 # Max lead of the stationary covariate(s): 0.000000000 # # Call: # dynlm(formula = formula(model), start = obs.1, end = obs.T) # # Residuals: # Min 1Q Median 3Q Max # -2.70728 -0.26235 0.00595 0.29684 1.47164 # Chan800064_c07.indd 152 6/7/2021 7:16:57 AM 76 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Special Topics in Quantitative Trading 153 In case you think that any two stocks in the same industry group would be cointegrating, here is a counterexample: KO (Coca-Cola) versus PEP (Pepsi). The same cointegration test as used in Exam- ple 7.1",
  "word_count": 1000,
  "topics": [
    "technical_analysis",
    "options",
    "market_structure",
    "crypto",
    "forex"
  ],
  "created_at": "2026-02-05T00:37:43.609374"
}