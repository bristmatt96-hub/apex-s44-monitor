{
  "id": "a8d3f77bd780",
  "source": "Quantitative_Trading.pdf",
  "source_type": "pdf",
  "title": "Quantitative Trading",
  "chunk_index": 12,
  "content": "is the maximum cumula- tive return of the strategy up to that time. (Using the cumulative return curve to calculate high watermark and drawdown is equivalent to using the equity curve, since equity is nothing more than initial investment times 1 plus the cumulative return.) From the high watermark, we can calculate the drawdown, the maximum drawdown, and maximum drawdown duration: Using Excel 1. In cell M3, type \u201c=L3\u201d. 2. In cell M4, type \u201c=(1+M3) *(1+L4)-1\u201d. This is the cumulative compounded return of the strategy up to that day. Populate the entire column M with the cumulative compounded returns of the strategy and erase the last cell of the column. Name this column Cumret. Chan800064_c03.indd 53 6/7/2021 2:04:50 PM 20 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 54 QUANTITATIVE TRADING 3. In cell N3, type \u201c=M3\u201d. 4. In cell N4, type \u201c=MAX(N3, M4)\u201d. This is the high watermark up to that day. Populate the entire column N with the running high watermark of the strategy and erase the last cell of the column. Name this column High watermark. 5. In cell O3, type \u201c=(1+M3)/(1+N3)-1\u201d. This is the drawdown at that day\u2019s close. Populate the entire column O with the drawdowns of the strategy. 6. In cell O1506, type \u201c=MAX(O3:O1505)\u201d. This is the maximum drawdown of the strategy. It should have a value of about 0.1053, that is, a maxi- mum drawdown of 10.53 percent. 7. In cell P3, type \u201c=IF(O3=0, 0, P2+1)\u201d. This is the duration of the current drawdown. Populate the entire column R with the drawdown durations of the strategy and erase the last cell of the column. 8. In cell P1506, type \u201c=MAX(P3:P1505)\u201d. This is the maximum drawdown duration of the strategy. It should have a value of 497, that is, a maxi- mum drawdown duration of 497 trading days. Using MATLAB % Assume this is a continuation of the above MATLAB % code. % cumulative compounded returns cumret=cumprod(1+netRet)-1;plot(cumret); [maxDrawdown maxDrawdownDuration]=... calculateMaxDD(cumret); % maximum drawdown. Output should be -0.0953 maxDrawdown % maximum drawdown duration. Output should be 497. maxDrawdownDuration Notice the code fragment above calls a function \u201ccalculateMaxDraw- down,\u201d which I display below. function [maxDD maxDDD]=calculateMaxDD(cumret) % [maxDD maxDDD]=calculateMaxDD(cumret) % calculation of maximum drawdown and maximum drawdown % duration based on cumulative compounded returns. % initialize high watermarks to zero. highwatermark=zeros(size(cumret)); % initialize drawdowns to zero. drawdown=zeros(size(cumret)); % initialize drawdown duration to zero. drawdownduration=zeros(size(cumret)); Chan800064_c03.indd 54 6/7/2021 2:04:50 PM 21 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Backtesting 55 for t=2:length(cumret) highwatermark(t)=... max(highwatermark(t-1), cumret(t)); % drawdown on each day drawdown(t)=(1+ cumret(t))/(1+ highwatermark(t))-1; if (drawdown(t)==0) drawdownduration(t)=0; else drawdownduration(t)=drawdownduration(t-1)+1; end end maxDD=max(drawdown); % maximum drawdown % maximum drawdown duration maxDDD=max(drawdownduration); The file that contains this function is available as epchan.com/book/ calculateMaxDD.m. You can see in Figure 3.1 where the maximum draw- down and maximum drawdown duration occurred in this plot of the cumu- lative returns. 0.6 0.5 0.4 0.3 0.2 0.1 0 0 200 400 600 800 1000 1200 1400 160 0 Days 497 days max drawdown duration 10.53% max drawdown \u20130.1 Cumulative Returns FIGURE 3.1 Maximum drawdown and maximum drawdown duration for Example 3.4. Chan800064_c03.indd 55 6/7/2021 2:04:50 PM J 22 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 56 QUANTITATIVE TRADING Using Python You will need to download the following calculateMaxDD.py code to your folder first: import numpy as np def calculateMaxDD(cumret): # ====================================================== # calculation of maximum drawdown and maximum drawdown duration based on # cumulative COMPOUNDED returns. cumret must be a com- pounded cumulative return. # i is the index of the day with maxDD. # ====================================================== highwatermark=np.zeros(cumret.shape) drawdown=np.zeros(cumret.shape) drawdownduration=np.zeros(cumret.shape) for t in np.arange(1, cumret.shape[0]): highwatermark[t]=np.maximum(highwatermark[t-1], cumret[t]) drawdown[t]=(1+cumret[t])/(1+highwatermark[t])-1 if drawdown[t]==0: drawdownduration[t]=0 else: drawdownduration[t]=drawdownduration[t-1]+1 maxDD, i=np.min(drawdown), np.argmin(drawdown) # drawdown < 0 always maxDDD=np.max(drawdownduration) return maxDD, maxDDD, i Then you can run the rest of Jupyter notebook: cumret=np.cumprod(1+netRet)-1 plt.plot(cumret) from calculateMaxDD import calculateMaxDD maxDrawdown, maxDrawdownDuration, startDrawdownDay=calcu lateMaxDD(cumret.values) maxDrawdown -0.09529268047208683 maxDrawdownDuration 497.0 startDrawdownDay 1223 Chan800064_c03.indd 56 6/7/2021 2:04:50 PM 23 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Backtesting 57 COMMON BACKTESTING PITFALLS TO AVOID Backtesting is the process of creating the historical trades given the historical information available at that time, and then finding out what the subsequent performance of those trades is. This process Using R You first need to download the function calculateMaxDD.R to your folder. # calculateMaxDD.R calculateMaxDD <- function(cumret) { # Assume compounded cumulative return as input highwatermark <- rep(0, length(cumret)) highwatermark drawdown <- rep(0, length(cumret)) drawdownduration <- rep(0, length(cumret)) for (t in 2:length(cumret)) { highwatermark[t] <- max(highwatermark[t-1], cumret[t]) drawdown[t] <- (1+cumret[t])/(1+highwatermark[t])-1 if (drawdown[t]==0) { drawdownduration[t]=0 } else { drawdownduration[t]=drawdownduration[t-1]+1 } } maxDD <- min(drawdown) maxDDD <- max(drawdownduration) return(c(maxDD, maxDDD)) } Then you can run the following code, which is the third part of example3_4.R: # 3rd part of example 3.4 source('calculateMaxDD.R') cumret <- cumprod(1+excessRet[!is.nan(excessRet)])-1 plot(cumret) output <- calculateMaxDD(cumret) maxDD <- output[1] maxDD maxDDD <- output[2] maxDDD Chan800064_c03.indd 57 6/7/2021 2:04:50 PM 24 This PDF file is",
  "word_count": 1000,
  "topics": [
    "options",
    "risk_management",
    "strategies",
    "forex"
  ],
  "created_at": "2026-02-05T00:37:43.605364"
}