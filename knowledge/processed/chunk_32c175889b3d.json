{
  "id": "32c175889b3d",
  "source": "Quantitative_Trading.pdf",
  "source_type": "pdf",
  "title": "Quantitative Trading",
  "chunk_index": 14,
  "content": "rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Backtesting 65 figure; plot(spread(testset)); figure; spreadMean=mean(spread(trainset)); % mean of spread on trainset spreadStd=std(spread(trainset)); % standard deviation of spread on trainset zscore=(spread - spreadMean)./spreadStd; % z-score of spread longs=zscore<=-2; % buy spread when its value drops below 2 standard deviations. shorts=zscore>=2; % short spread when its value rises above 2 standard deviations. exitLongs=zscore>=-1; % exit any spread position when its value is within 1 standard deviation of its mean. exitShorts=zscore<=1; % exit any spread position when its value is within 1 standard deviation of its mean. positionsL=zeros(length(tday), 2); % initialize long positions array positionsS=zeros(length(tday), 2); % initialize long positions array positionsS(shorts, :)=repmat([-1 1], [length(find(shorts)) 1]); % long entries positionsL(longs, :)=repmat([1 -1], [length(find(longs)) 1]); % short entries positionsL(exitLongs, :)=zeros(length(find(exitLongs)), 2); % exit positions positionsS(exitShorts, :)=zeros(length(find(exitSho rts)), 2); % exit positions positions=positionsL+positionsS; Chan800064_c03.indd 65 6/7/2021 2:04:51 PM 27 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 66 QUANTITATIVE TRADING positions=fillMissingData(positions); % ensure existing positions are carried forward unless there is an exit signal cl=[cl1 cl2]; % combine the 2 price series dailyret=(cl - lag1(cl))./lag1(cl); pnl=sum(lag1(positions).*dailyret, 2); sharpeTrainset=sqrt(252)*mean(pnl(trainset(2:end)))./ std(pnl(trainset(2:end))) % the Sharpe ratio on the training set should be about 2.3 sharpeTestset=sqrt(252)*mean(pnl(testset))./ std(pnl(testset)) % the Sharpe ratio on the test set should be about 1.5 % sharpeTrainset = % % 2.0822 % % % sharpeTestset = % % 1.4887 plot(cumsum(pnl(testset))); save example3_6_positions positions; % save positions file for checking look-ahead bias. In file lag1.m: function y=lag1(x) % y=lag(x) if (isnumeric(x)) % populate the first entry with NaN y=[NaN(1,size(x,2));x(1:end-1, :)];elseif (ischar(x)) % populate the first entry with \" y=[repmat(\",[1 size(x,2)]);x(1:end-1, :)];else error(`Can only be numeric or char array'); end So this pair-trading strategy has excellent Sharpe ratios on both the training set and the test set. Therefore, this strategy can be considered free of data-snooping bias. However, there may be room for improvement. Let\u2019s Chan800064_c03.indd 66 6/7/2021 2:04:51 PM 28 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Backtesting 67 see what happens if we change the entry thresholds to 1 standard devia- tion and exit threshold to 0.5 standard deviation. In this case, the Sharpe ratio on the training set increases to 2.9 and the Sharpe ratio on the test set increases to 3.0. So, clearly, this set of thresholds is better. Often, however, optimizing the parameters on the training set may decrease the performance on the test set. In this situation, you should choose a set of parameters that result in good (but may not be the best) performance on both training and test sets. I have not incorporated transaction costs (which I discuss in the next section) into this analysis. You can try to add that as an exercise. Since this strategy doesn\u2019t trade very frequently, transaction costs do not have a big impact on the resulting Sharpe ratio. To see why this strategy works, just take a look at Figure 7.4 of the spread, which I will discuss in connection with stationarity and cointegra- tion in Chapter 2. You can see that the spread behaves in a highly mean- reverting manner. Hence, buying low and selling high over and over again works well here. One last check, though, that we should perform before calling this a success: We need to check for any look-ahead bias in the backtest pro- gram. Add the following code fragment to the previous MATLAB code after the line \u201ccl2=adjcls2(idx2);\u201d % number of most recent trading days to cut off cutoff=60;% remove the last cutoff number of days. tday(end-cutoff+1:end, :)=[]; cl1(end-cutoff+1:end, :)=[]; cl2(end-cutoff+1:end, :)=[]; Add the following code fragment to the very end of the previous MAT- LAB program, replacing the line \u201csave example3_6_positions positions.\u201d % step two of look-forward-bias check oldoutput=load(`example3_6_positions'); oldoutput.positions(end-cutoff+1:end, :)=[]; if (any(positions~=oldoutput.positions)) fprintf(1, `Program has look-forward-bias!\\n'); end Save this new program into file \u201cexample3_6_1.m\u201d and run it. You will find that the sentence \u201cProgram has look-forward-bias\u201d is not printed out\u2014 this indicates that our algorithm passed our test. Using Python You can download the Python code in the Jupyter notebook exam- ple3_6.ipynb.Chan800064_c03.indd 67 6/7/2021 2:04:51 PM 29 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 68 QUANTITATIVE TRADING Pair Trading of GLD and GDX import numpy as np import pandas as pd import matplotlib.pyplot as plt import statsmodels.api as sm df1=pd.read_excel('GLD.xls') df2=pd.read_excel('GDX.xls') df=pd.merge(df1, df2, on='Date', suffixes=('_GLD', '_ GDX')) df.set_index('Date', inplace=True) df.sort_index(inplace=True) trainset=np.arange(0, 252) testset=np.arange(trainset.shape[0], df.shape[0]) Determine hedge ratio on trainset model=sm.OLS(df.loc[:, 'Adj Close_GLD'].iloc[trainset], df.loc[:, 'Adj Close_GDX'].iloc[trainset]) results=model.fit() hedgeRatio=results.params hedgeRatio Adj Close_GDX 1.631009 dtype: float64 spread=GLD - hedgeRatio*GDX spread=df.loc[:, 'Adj Close_GLD']-hedgeRatio[0]*df. loc[:, 'Adj Close_GDX'] plt.plot(spread.iloc[trainset]) plt.plot(spread.iloc[testset]) spreadMean=np.mean(spread.iloc[trainset]) spreadMean 0.05219623850035999 spreadStd=np.std(spread.iloc[trainset]) spreadStd 1.944860873496509 df['zscore']=(spread-spreadMean)/spreadStd df['positions_GLD_Long']=0 df['positions_GDX_Long']=0 df['positions_GLD_Short']=0 df['positions_GDX_Short']=0 df.loc[df.zscore>=2, ('positions_GLD_Short', 'positions_ GDX_Short')]=[-1, 1] # Short spread df.loc[df.zscore<=-2, ('positions_GLD_Long', 'positions_ GDX_Long')]=[1, -1] # Buy spread df.loc[df.zscore<=1, ('positions_GLD_Short', 'positions_ GDX_Short')]=0 # Exit short spread Chan800064_c03.indd 68 6/7/2021 2:04:51 PM 30 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc.",
  "word_count": 1000,
  "topics": [
    "options",
    "psychology",
    "market_structure",
    "strategies",
    "forex"
  ],
  "created_at": "2026-02-05T00:37:43.605767"
}