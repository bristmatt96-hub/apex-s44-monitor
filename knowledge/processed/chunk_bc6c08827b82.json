{
  "id": "bc6c08827b82",
  "source": "Quantitative_Trading.pdf",
  "source_type": "pdf",
  "title": "Quantitative Trading",
  "chunk_index": 40,
  "content": "John Wiley & Sons, Inc. All Rights Reserved. 166 QUANTITATIVE TRADING import pandas as pd from numpy.linalg import eig from numpy.linalg import eigh #from statsmodels.api import OLS import statsmodels.api as sm from sklearn.linear_model import LinearRegression from sklearn.multioutput import MultiOutputRegressor from sklearn.decomposition import PCA from sklearn.preprocessing import StandardScaler from sklearn import linear_model from sklearn.linear_model import Ridge import time lookback=252 # training period for factor exposure numFactors=5 topN=50 # for trading strategy, long stocks with topN exepcted 1-day returns df=pd.read_table('IJR_20080114.txt') df['Date']=df['Date'].astype('int') df.set_index('Date', inplace=True) df.sort_index(inplace=True) df.fillna(method='ffill', inplace=True) dailyret=df.pct_change() # note the rows of dailyret are the observations at different time periods positionsTable=np.zeros(df.shape) end_index = df.shape[0] #end_index = lookback + 10 for t in np.arange(lookback+1,end_index): R=dailyret.iloc[t-lookback+1:t,].T # here the columns of R are the different observations. hasData=np.where(R.notna().all(axis=1))[0] R.dropna(inplace=True) # avoid any stocks with missing returns pca = PCA() X = pca.fit_transform(R.T)[:, :numFactors] X = sm.add_constant(X) y1 = R.T clf = MultiOutputRegressor(LinearRegression(fit_ intercept=False),n_jobs=4).fit(X, y1) Rexp = np.sum(clf.predict(X),axis=0) R=dailyret.iloc[t-lookback+1:t+1,].T # here the columns of R are the different observations. idxSort=Rexp.argsort() positionsTable[t, hasData[idxSort[np.arange(0, topN)]]]=-1 # positionsTable[t, hasData[idxSort[np.arange(- topN,0)]]]=1 Chan800064_c07.indd 166 6/7/2021 7:16:58 AM 86 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Special Topics in Quantitative Trading 167 positionsTable[t, hasData[idxSort[np.arange(-topN, -1)]]] = 1 capital=np.nansum(np.array(abs(pd. DataFrame(positionsTable)).shift()), axis=1) positionsTable[capital==0,]=0 capital[capital==0]=1 ret=np.nansum(np.array(pd.DataFrame(positionsTable). shift())*np.array(dailyret), axis=1)/capital avgret=np.nanmean(ret)*252 avgstdev = np.nanstd(ret)*math.sqrt(252) Sharpe = avgret/avgstdev print(avgret) print(avgstdev) print(Sharpe) #0.04052422056844459 #0.07002908500498846 #0.5786769963588398 Using R You can download the R code as example7_4.R. rm(list=ls()) # clear workspace backshift <- function(mylag, x) { rbind(matrix(NaN, mylag, ncol(x)), as.matrix(x[1:(nrow(x)-mylag),])) } #install.packages('pls') library(\"pls\") library('zoo') source('calculateReturns.R') #source('backshift.R') lookback <- 252 # use lookback days as estimation (training) period for determining factor exposures. numFactors <- 5 topN <- 50 # for trading strategy, long stocks with topN expected 1-day returns. data1 <- read.csv(\"IJR_20080114.csv\") # Tab-delimited cl <- data.matrix(data1[, 2:ncol(data1)]) cl[ is.nan(cl) ] <- NA tday <- data.matrix(data1[, 1]) mycls <- na.fill(cl, type=\"locf\", nan=NA, fill=NA) end_loop <- nrow(mycls) positionsTable <- matrix(0, end_loop, ncol(mycls)) dailyret <- calculateReturns(mycls, 1) dailyret[is.nan(dailyret)] <- 0 Chan800064_c07.indd 167 6/7/2021 7:16:58 AM 87 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 168 QUANTITATIVE TRADING dailyret <- dailyret[1:end_loop,] for (it in (lookback+2):end_loop) { R <- dailyret[(it-lookback+2):it,] hasData <- which(complete.cases(t(R))) R <- R[, hasData ] PCA <- prcomp(t(R)) X <- t(PCA$x[1:numFactors,]) Rexp <- rep(0,ncol(R)) for (s in 1:ncol(R)){ reg_result <- lm(R[,s] ~ X ) pred <- predict(reg_result) pred[is.nan(pred)] <- 0 Rexp[s] <- sum(pred) } result <- sort(Rexp, index.return=TRUE) positionsTable[it, hasData[result$ix[1:topN]] ] = -1 positionsTable[it, hasData[result$ix[(length(result $ix)-topN-1):length(result$ix)]] ] = 1 } capital <- rowSums(abs(backshift(1, positionsTable)), na.rm = TRUE, dims = 1) ret <- rowSums(backshift(1, positionsTable)*dailyret, na.rm = TRUE, dims = 1)/capital avgret <- 252*mean(ret, na.rm = TRUE) avgstd <- sqrt(252)*sd(ret, na.rm = TRUE) Sharpe = avgret/avgstd print(avgret) print(avgstd) print(Sharpe) #0.04052422056844459 #0.07002908500498846 #0.5786769963588398 How good are the performances of factor models in real trading? Naturally, it mostly depends on which factor model we are looking at. But one can make a general observation that factor models that are dominated by fundamental and macroeconomic factors have one major drawback\u2014they depend on the fact that investors persist in using the same metric to value companies. This is just another way of saying that the factor returns must have momentum for fac- tor models to work. Chan800064_c07.indd 168 6/7/2021 7:16:58 AM 88 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Special Topics in Quantitative Trading 169 For example, even though the value (HML) factor returns are usually positive, there are periods of time when investors prefer growth stocks, such as during the internet bubble in the late 1990s, in 2007, and quite recently from 2017 to 2020. As The Economist noted, one reason growth stocks were back in favor in 2007 is the simple fact that their price premium over value stocks had narrowed significantly (Economist, 2007a). Another reason is that as the US economy slowed, investors increasingly opted for companies that still managed to generate increasing earnings instead of those that were hurt by the recessionary economy. In 2020, Covid-19 caused many sectors of the economy to slump, but not for technology com- panies, as consumers and businesses moved much of their activities to online only. Therefore, it is not uncommon for factor models to experience steep drawdown during the times when investors\u2019 valuation methods shift, even if only for a short duration. But then, this problem is com- mon to practically any trading model that holds stocks overnight. WHAT IS YOUR EXIT STRATEGY? While entry signals are very specific to each trading strategy, there isn\u2019t usually much variety in the way exit signals are generated. They are based on one of these: \u2022 A fixed holding period \u2022 A target price or profit cap \u2022 The latest entry signals \u2022 A stop price A fixed holding period is the default exit strategy for any trading strategy, whether it is a momentum model, a reversal model, or some kind of seasonal trading strategy, which can be either momentum or reversal based (more on this later). I said before that one of the ways momentum is generated is the slow diffusion of information. Chan800064_c07.indd 169 6/7/2021 7:16:58 AM Special Topics in Quantitative Trading 171 robust than can be obtained directly from a trading model. In Exam- ple 7.5, I demonstrate this method of estimating the half-life of mean reversion",
  "word_count": 1000,
  "topics": [
    "technical_analysis",
    "options",
    "risk_management",
    "fundamentals",
    "strategies",
    "macro"
  ],
  "created_at": "2026-02-05T00:37:43.610215"
}