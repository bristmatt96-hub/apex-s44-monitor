{
  "id": "deb97a50ea02",
  "source": "Quantitative_Trading.pdf",
  "source_type": "pdf",
  "title": "Quantitative Trading",
  "chunk_index": 26,
  "content": "[num2, txt2]=xlsread('RKH'); % the first column (starting from the second row) is % the trading days in format mm/dd/yyyy. tday2=txt2(2:end, 1); % convert the format into yyyymmdd. tday2=.. datestr(datenum(tday2, 'mm/dd/yyyy'), 'yyyymmdd'); % convert the date strings first into cell arrays and % then into numeric format. tday2=str2double(cellstr(tday2)); adjcls2=num2(:, end); % read a spreadsheet named \"RTH.xls\" into MATLAB. [num3, txt3]=xlsread('RTH'); % the first column (starting from the second row) is Chan800064_c06.indd 114 6/7/2021 2:06:03 PM 53 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Money and Risk Management 115 % the trading days in format mm/dd/yyyy. tday3=txt3(2:end, 1); % convert the format into yyyymmdd. tday3=.. datestr(datenum(tday3, 'mm/dd/yyyy'), 'yyyymmdd'); % convert the date strings first into cell arrays and % then into numeric format. tday3=str2double(cellstr(tday3)); adjcls3=num3(:, end); % merge these data tday=union(tday1, tday2); tday=union(tday, tday3); adjcls=NaN(length(tday), 3); [foo idx1 idx]=intersect(tday1, tday); adjcls(idx, 1)=adjcls1(idx1); [foo idx2 idx]=intersect(tday2, tday); adjcls(idx, 2)=adjcls2(idx2); [foo idx3 idx]=intersect(tday3, tday); adjcls(idx, 3)=adjcls3(idx3); ret=(adjcls-lag1(adjcls))./lag1(adjcls); % returns % days where any one return is missing baddata=find(any(~isfinite(ret), 2)); % eliminate days where any one return is missing ret(baddata,:)=[]; % excess returns: assume annualized risk free rate is 4% excessRet=ret-repmat(0.04/252, size(ret)); % annualized mean excess returns M=252*mean(excessRet, 1)'% M = % % 0.1396 % 0.0294 % -0.0073 C=252*cov(excessRet) % annualized covariance matrix % C = % % 0.1109 0.0200 0.0183 % 0.0200 0.0372 0.0269 % 0.0183 0.0269 0.0420 Chan800064_c06.indd 115 6/7/2021 2:06:03 PM 54 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 116 QUANTITATIVE TRADING F=inv(C)*M % Kelly optimal leverages % F = % % 1.2919 % 1.1723 % -1.4882 Notice that the mean excess return of RTH is negative. Given this, it is not surprising that the Kelly formula recommends we short RTH. You might wonder what the Sharpe ratio and the maximum com- pounded growth rate generated using this optimal allocation are. It turns out that the maximum growth rate of a multistrategy Gaussian process is g Fr FC FT /2 and the Sharpe ratio is given by SF TCF . Here is the MATLAB code snippet that calculates these two quantities: % Maximum annualized compounded growth rate g=0.04+F'*C*F/2 % g = % % 0.1529 S=sqrt(F'*C*F) % Sharpe ratio of portfolio % S = % % 0.4751 Notice that the compounded growth rate of the portfolio is 15.29 per- cent, higher than that of the maximum growth rate achievable by any of the individual stocks. (As an exercise, you can verify that the compounded growth rate of OIH, which has the highest one-period return among the three stocks, is 12.78 percent.) Using Python Here is the equivalent Python Jupyter Notebook code, downloadable as example6_3.ipynb. Calculating the Optimal Allocation Using Kelly formula import numpy as np import pandas as pd from numpy.linalg import inv df1=pd.read_excel('OIH.xls') Chan800064_c06.indd 116 6/7/2021 2:06:03 PM ( *) = + * * 55 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Money and Risk Management 117 df2=pd.read_excel('RKH.xls') df=pd.merge(df1, df2, on='Date', suffixes=('_OIH', '_RKH')) df.set_index('Date', inplace=True) df3=pd.read_excel('RTH.xls') df=pd.merge(df, df3, on='Date') df.rename(columns={\"Adj Close\": \"Adj Close_RTH\"}, inplace=True) df.set_index('Date', inplace=True) df.sort_index(inplace=True) dailyret=df.loc[:, ('Adj Close_OIH', 'Adj Close_RKH', 'Adj Close_RTH')].pct_change() dailyret.rename(columns={\"Adj Close_OIH\": \"OIH\", \"Adj Close_RKH\": \"RKH\", \"Adj Close_RTH\": \"RTH\"}, inplace=True) excessRet=dailyret-0.04/252 M=252*excessRet.mean() M OIH 0.139568 RKH 0.029400 RTH -0.007346 dtype: float64 C=252*excessRet.cov() C OIH RKH RTH OIH 0.110901 0.020014 0.018255 RKH 0.020014 0.037165 0.026893 RTH 0.018255 0.026893 0.041967 F=np.dot(inv(C), M) F array([ 1.2919082 , 1.17226473, -1.48821285]) g=0.04+np.dot(F.T, np.dot(C, F))/2 g 0.1528535789840623 S=np.sqrt(np.dot(F.T, np.dot(C, F))) S 0.47508647420035505 Chan800064_c06.indd 117 6/7/2021 2:06:03 PM 56 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. 118 QUANTITATIVE TRADING Using R Here is the R code, downloadable as example6_3.R. library('zoo') source('calculateReturns.R') source('calculateMaxDD.R') source('backshift.R') data1 <- read.delim(\"OIH.txt\") # Tab-delimited data_sort1 <- data1[order(as.Date(data1[,1], '%m/%d/%Y')),] # sort in ascending order of dates (1st column of data) tday1 <- as.integer(format(as.Date(data_sort1[,1], '%m/%d/%Y'), '%Y%m%d')) adjcls1 <- data_sort1[,ncol(data_sort1)] data2 <- read.delim(\"RKH.txt\") # Tab-delimited data_sort2 <- data2[order(as.Date(data2[,1], '%m/%d/%Y')),] # sort in ascending order of dates (1st column of data) tday2 <- as.integer(format(as.Date(data_sort2[,1], '%m/%d/%Y'), '%Y%m%d')) adjcls2 <- data_sort2[,ncol(data_sort2)] data3 <- read.delim(\"RTH.txt\") # Tab-delimited data_sort3 <- data3[order(as.Date(data3[,1], '%m/%d/%Y')),] # sort in ascending order of dates (1st column of data) tday3 <- as.integer(format(as.Date(data_sort3[,1], '%m/%d/%Y'), '%Y%m%d')) adjcls3 <- data_sort3[,ncol(data_sort3)] # merge these data tday <- union(tday1, tday2) tday <- union(tday, tday2) tday <- tday[order(tday)] adjcls <- matrix(NaN, length(tday), 3) adjcls[tday %in% tday1, 1] <- adjcls1 adjcls[tday %in% tday2, 2] <- adjcls2 adjcls[tday %in% tday3, 3] <- adjcls3 ret <- calculateReturns(adjcls, 1) # daily returns excessRet <- ret - 0.04/252 # excess returns: assume annualized risk free rate is 4% Chan800064_c06.indd 118 6/7/2021 2:06:03 PM 57 This PDF file is part of the audiobook QUANTITATIVE TRADING and cannot be sold separately. It may not be reproduced, copied, circulated, or posted online. All rights reserved. Copyright \u00a9 Ernest P . Chan, 2021. Published by Echo Point Books & Media, LLC by arrangement with John Wiley & Sons, Inc. All Rights Reserved. Money and Risk Management 119 Note that following the Kelly formula requires you to continu- ously adjust your capital allocation",
  "word_count": 1000,
  "topics": [
    "risk_management",
    "market_structure",
    "strategies",
    "forex"
  ],
  "created_at": "2026-02-05T00:37:43.607963"
}